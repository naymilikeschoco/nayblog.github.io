# 查找

## B-树

<img src="file:///D:/Users/asus/Pictures/Typedown/6a3c6147-8402-44b9-a9b3-a7006415f315.png" title="" alt="6a3c6147-8402-44b9-a9b3-a7006415f315" style="zoom:50%;">

B-树主要用作文件索引

<img src="file:///D:/Users/asus/Pictures/Typedown/cb103d95-104d-45e4-bbb5-d9f14e5e507c.png" title="" alt="cb103d95-104d-45e4-bbb5-d9f14e5e507c" style="zoom:50%;">

<img src="file:///D:/Users/asus/Pictures/Typedown/37ee1c86-2d54-4683-9d69-5e858bf7e686.png" title="" alt="37ee1c86-2d54-4683-9d69-5e858bf7e686" style="zoom:50%;">

*B-树是一种平衡的多路查找树*



*B-树的查找* ：

类似二叉排序树的查找，所不同的是B-树每个结点上是多关键码的有序表:

 (1)在到达某个结点时，先在(多关键码的)有序表中查找，若找到，则查找成功；

(2)否则，到按照对应的指针信息指向的子树中去查找，当到达叶子结点时，则说明树中没有对应的关键码，查找失败。

即在B-树上的查找过程是一个**顺指针查找结点**和**在结点中查找关键码**交叉进行的过程。

*B-树的插入* ：

（1）插入后，该结点的关键字个数n<m（or≤m-1），不修改指针; 
（2）若双亲为空，则建新的根结点

（3）如果插入后，该节点的关键字个数n=m，则需要“结点分裂”，令 s = m/2（向上取整），在原结点中保留一半的关键字(s-1，A0，K1，……  ， Ks-1，As-1）；建新结点*q 储存另一半的关键字(m-s,As，Ks+1，……  ，Km，Am）；将中间值(Ks，q)插入双亲结点；其中q为指向新结点的指针。否则直接插入最下层的非叶结点

- 为什么需要将中间位置的关键字(Ks，q)插入双亲结点？
  否则不符合B-树定义，子树数目增加，双亲节点的关键字数目也得增加。



*B-树的删除* ：

分4种情况:

删除叶节点：

删除之后，如果变空或者减少到不满足最小结点数，看能不能找兄弟节点借，不够借就合并兄弟节点，并把双亲结点中对应关键字也拿下来。（不平衡时就要合并和调整）

![2c9d337a-f0f8-4b17-be96-ee0eff427a79](file:///D:/Users/asus/Pictures/Typedown/2c9d337a-f0f8-4b17-be96-ee0eff427a79.png)

删除非叶节点时，把右子树的最小关键字或者左子树的最大关键字拿来替代。

![223cb5cb-1754-4c46-915a-06ac7adf04cb](file:///D:/Users/asus/Pictures/Typedown/223cb5cb-1754-4c46-915a-06ac7adf04cb.png)

特点分析：（根结点至少含2棵子树；非叶结点至少含有m/2（向上取整）棵子树）

在B-树中进行查找时，其查找时间主要花费在搜索结点（访问外存）上，即主要取决于B-树的深度。

假设 m 阶 B-树的深度为 H+1，由于第 H+1 层为叶子结点，而当前树中含有 N 个关键字，则叶子结点必为 N+1 个 

在含 N 个关键字的 B-树上进行一次查找，需访问的结点个数不超过：

 ![58d8b19c-c928-450c-8a44-bf71439c47dc](file:///D:/Users/asus/Pictures/Typedown/58d8b19c-c928-450c-8a44-bf71439c47dc.png)

## B+树

B+树可以看作是B-树的一种变形;
在实现文件索引结构方面比B-树使用得普遍。

![fd6f179a-3a55-4db0-9e0b-450c17d4037e](file:///D:/Users/asus/Pictures/Typedown/fd6f179a-3a55-4db0-9e0b-450c17d4037e.png)

B+树的特点：

所有的叶子结点中包含了全部关键字的信息，及指向含有这些关键码记录的指针;
所有的非终端结点可以看成是索引，有n棵子树的结点含有n个关键字；结点中仅含有其子树根结点中最大(或最小)关键码；
通常在B+树上有两个头指针，一个指向根结点，另一个指向关键码最小的叶子结点。

两个头指针，可以进行两种查找：既可以从最小关键字起顺序查找，也可以进行缩小范围的查找，从根结点开始，进行随机查找。在进行缩小范围的查找时，不管成功与否，都必须查到叶子结点才能结束

在B+树，不管查找成功与否，每次查找都是走了一条从根到叶子结点的路径。

B+树的插入和删除：

类似于B-树。必要时，也需要进行结点的“分裂”或“归并”

B+树的插入和删除都只在叶子结点进行，当结点中的关键字个数大于m时，要分裂成两个结点；当小于⌈m/2⌉时，和兄弟结点合并。
